rep(months,30),"_",rep(years,each = 12),"_V.2.1.tif"))
tmin <- c(paste0("https://os.zhdk.cloud.switch.ch/envicloud/chelsa/chelsa_V2/GLOBAL/monthly/tasmin/CHELSA_tasmin_",
rep(months,15),"_",rep(years,each = 12),"_V.2.1.tif"))
tmax <- c(paste0("https://os.zhdk.cloud.switch.ch/envicloud/chelsa/chelsa_V2/GLOBAL/monthly/tasmax/CHELSA_tasmax_",
rep(months,15),"_",rep(years,each = 12),"_V.2.1.tif"))
txt_file <- c(precip, tmin, tmax)
txt_file
# raster I use to define cropping extent
ref_extent <- raster("D:/Climate/CHELSA2/bio1_1981-2010_V.2.1.tif")
# raster I use to define cropping extent
ref_extent <- raster("/Users/pburnham/Documents/geospatialData/Carya_ovata/Carya_ovata_sim_disc_10km.tif")
# raster I use to define cropping extent
ref_extent <- raster("/Users/pburnham/Documents/geospatialData/Carya_ovata/Carya_ovata_sim_disc_10km.tif")
plot(ref_extent)
for(f in c(1:length(txt_file))){
# Download file from CHELSA
url <- txt_file[f]
name <- gsub(".*/CHELSA_","",url)
dest_file <- paste("D:/Climate/CHELSA_BIOCLIM+/",name,sep ="")
download.file(url=url, destfile=dest_file, method="auto", quiet = F, mode = "wb", cacheOK = TRUE)
# Crop and save cropped file
org_file <- raster(dest_file)
e <- extent(ref_extent)
cropped_file <- crop(org_file,e)
writeRaster(cropped_file, filename=dest_file, overwrite=TRUE)
print(name)
}
z
for(f in c(1:length(txt_file))){
# Download file from CHELSA
url <- txt_file[f]
name <- gsub(".*/CHELSA_","",url)
print(name)
dest_file <- paste("D:/Climate/CHELSA_BIOCLIM+/",name,sep ="")
download.file(url=url, destfile=dest_file, method="auto", quiet = F, mode = "wb", cacheOK = TRUE)
# Crop and save cropped file
org_file <- raster(dest_file)
e <- extent(ref_extent)
cropped_file <- crop(org_file,e)
writeRaster(cropped_file, filename=dest_file, overwrite=TRUE)
print(name)
}
for(f in c(1:length(txt_file))){
# Download file from CHELSA
url <- txt_file[f]
name <- gsub(".*/CHELSA_","",url)
dest_file <- paste("/Users/pburnham/Documents/geospatialData/chelsa_data/",name,sep ="")
download.file(url=url, destfile=dest_file, method="auto", quiet = F, mode = "wb", cacheOK = TRUE)
# Crop and save cropped file
org_file <- raster(dest_file)
e <- extent(ref_extent)
cropped_file <- crop(org_file,e)
writeRaster(cropped_file, filename=dest_file, overwrite=TRUE)
}
for(f in c(1:length(txt_file))){
print(f)
# Download file from CHELSA
url <- txt_file[f]
name <- gsub(".*/CHELSA_","",url)
dest_file <- paste("/Users/pburnham/Documents/geospatialData/chelsa_data/",name,sep ="")
download.file(url=url, destfile=dest_file, method="auto", quiet = F, mode = "wb", cacheOK = TRUE)
# Crop and save cropped file
org_file <- raster(dest_file)
e <- extent(ref_extent)
cropped_file <- crop(org_file,e)
writeRaster(cropped_file, filename=dest_file, overwrite=TRUE)
print(name)
}
getOption('timeout')
options(timeout=100)
getOption('timeout')
for(f in c(1:length(txt_file))){
print(f)
# Download file from CHELSA
url <- txt_file[f]
name <- gsub(".*/CHELSA_","",url)
dest_file <- paste("/Users/pburnham/Documents/geospatialData/chelsa_data/",name,sep ="")
download.file(url=url, destfile=dest_file, method="auto", quiet = F, mode = "wb", cacheOK = TRUE)
# Crop and save cropped file
org_file <- raster(dest_file)
e <- extent(ref_extent)
cropped_file <- crop(org_file,e)
writeRaster(cropped_file, filename=dest_file, overwrite=TRUE)
print(name)
}
options(timeout=100)
txt_file
library(tidyverse)
library(dplyr)
library(ggplot2)
library(tidyverse)
library(dplyr)
library(ggplot2)
setwd("~/Documents/GitHub/SARE")
# Read in Tosi Datasets
tosi_lethal <- read.csv("pesticide_data_to_merge/Tosi_lethal.csv", header = TRUE, stringsAsFactors = FALSE, skip = 1)
tosi_sublethal <- read.csv("pesticide_data_to_merge/Tosi_sublethal.csv", header = TRUE, stringsAsFactors = FALSE)
# Read in Description Dataset
pest_Desc <- read.csv("pesticide_data_to_merge/pestDesc.csv", header = TRUE, stringsAsFactors = FALSE)
# Read in Cornell Results Dataset !NOTE! - find more general solution to white space/column headers
pest_Results <- read.csv("pesticide_data_to_merge/pesticide_results_2021.csv", header = TRUE,
stringsAsFactors = FALSE, skip = 1)
# replace n.d. with NA
pest_Results[pest_Results == "n.d."] <- NA
# find our cut points
LS_row <- which(pest_Results == "Large Scale", arr.ind=TRUE)[1]
SS_row <- which(pest_Results == "Small Scale", arr.ind=TRUE)[1]
SS_filename_row <- which(pest_Results == "File Name", arr.ind=TRUE)[1]
bottom_row <- which(pest_Results == "Results are in ppb.", arr.ind=TRUE)[1] #find regex solution Results are in *
# cut out our data frames
LS_df <- pest_Results[1:(LS_row-1),]
SS_df <- pest_Results[(SS_filename_row+1):(SS_row-1),]
# cut out look up tables
LS_lookup <- pest_Results[LS_row:(LS_row+3),]
SS_lookup <- pest_Results[SS_row:(SS_row+3),]
#######################################################
# LIMIT FINDER FUNCTION
#######################################################
limit_finder <- function(df, search, lookup, scale){
# find where samples say <loq
loqVals <- data.frame(which(df == search, arr.ind=TRUE))
if(length(loqVals$row>0)){
# pull out mass and lod and do out the division
mass <- as.numeric(df$Mass..g.[loqVals$row])
scaleNum <- ifelse(search==">ULOQ", 3, 1) # convert scale into row index
print(scaleNum)
lod <- as.numeric(lookup[scaleNum,loqVals$col])
results <- lod/mass
# assign results to index where loq was found
for(i in 1:length(results)){
df[loqVals$row[i], loqVals$col[i]] <- results[i]
}
}
return(df)
}
LS_df <- limit_finder(df = LS_df, search = "<LOQ", lookup = LS_lookup)
SS_df <- limit_finder(df = SS_df, search = "<LOQ", lookup = SS_lookup)
LS_df <- limit_finder(df = LS_df, search = ">ULOQ", lookup = LS_lookup)
SS_df <- limit_finder(df = SS_df, search = ">ULOQ", lookup = SS_lookup)
# append dataframes
pest_df <- rbind(LS_df, SS_df)
# create small scale/large scale column
pest_df$scale <- ifelse(pest_df$Mass..g. < 1, "small", "large")
str(pest_df)
view(pest_df)
################################################################################
# Cleaning LD50 Dataset -- Tosi Lethal
################################################################################
tosi_lethal
view(tosi_lethal)
# convert blank spaces to NA
tosi_lethal[tosi_lethal == " "] <- NA
tosi_lethal[tosi_lethal == ""] <- NA
view(tosi_lethal)
# changing column names
colnames(tosi_lethal) # original column names
tosi_lethal_colnames <- c("pesticide_name", "other_names","cas", "pesticide_type", "MoA_short", "MoA_classification_site_target", "oral_LD50_geometricmean_ugbee", "oral_source_num","oral_LD50_min", "oralQ1", "oralQ2_median", "oralQ3", "oral_LD50_max", "oral_range", "oral_source_name", "oral_LD50_1", "oral_LD50_2", "oral_LD50_3", "oral_LD50_4", "oral_LD50_5", "contact_LD50_geometricmean_ugbee","contact_source_num","contact_LD50_min", "contactQ1", "contactQ2_median", "contactQ3", "contact_LD50_max","contact_range", "contact_source_name", "contact_LD50_1", "contact_LD50_2","contact_LD50_3")
colnames(tosi_lethal) <- tosi_lethal_colnames
colnames(tosi_lethal) # verify new column names
# finding minLD50 value
tosi_lethal %>%
rowwise() %>%
mutate(min_LD50_value = min(oral_LD50_min, oral_LD50_1, oral_LD50_2, oral_LD50_3, oral_LD50_4, oral_LD50_5, contact_LD50_min, contact_LD50_1, contact_LD50_2, contact_LD50_3))
tosi_lethal
# finding minLD50 value
tl <- tosi_lethal %>% rowwise() %>% mutate(min_LD50_value = min(oral_LD50_min, oral_LD50_1, oral_LD50_2, oral_LD50_3, oral_LD50_4, oral_LD50_5, contact_LD50_min, contact_LD50_1, contact_LD50_2, contact_LD50_3))
View(tl)
# finding minLD50 value
tl <- tosi_lethal %>% rowwise() %>% mutate(min_LD50_value = min(oral_LD50_min, oral_LD50_1, oral_LD50_2, oral_LD50_3, oral_LD50_4, oral_LD50_5, contact_LD50_min, contact_LD50_1, contact_LD50_2, contact_LD50_3, na.rm = TRUE))
View(tl)
tl$min_LD50_value
tosi_lethal[,3]
tosi_lethal[3,]
tosi_lethal[4,]
tosi_lethal[40,]
tosi_lethal[400,]
tosi_lethal[30,]
tl$min_LD50_value
tosi_lethal[21,]
tl$min_LD50_value
tosi_lethal[51,]
if(tl$min_LD50_value == "Inf"){
tl$min_LD50_value = NA
}
ifelse(tl$min_LD50_value == "Inf", NA, min_LD50_value)
ifelse(tl$min_LD50_value == "Inf", NA, tl$min_LD50_value)
# remove Inf values
tl$min_LD50_value <- ifelse(tl$min_LD50_value == "Inf", NA, tl$min_LD50_value)
view(tosi_sublethal)
colnames(tosi_sublethal)
tosi_sublethal_colnames <- c("pesticide_name", "cas", "pesticide_type", "MoA_short", "MoA_classification_site_taret", "survey_inclusion_name", "screened_in_survey", "num_survery_screenings", "oral_LD50_geometricmean_ugbee", "oral_source_name", "contact_LD50_geometricmean_ugbee", "contact_source_name", "LOAEL_allunits", "LOAEL_unit_measure", "LOAEL_ug/bee/day", "LOAEL_category_ug/bee", "SubTR_LOAEL/LD50", "SubTR_category", "exposure_type_oral_v_contact", "exposure_type_acute_v_chronic", "exposure_duration_h", "time_after_exposure_of_significant_effect_h", "feedtype_main_category", "feedtype_subcategory", "feedtype_concentration", "bee_type", "bee_genus", "bee_species", "bee_species_details", "sublethal_effect_main_category", "sublethal_effect_subcategory", "sublethal_effect_details", "original_ref", "ref_year", "review_ref")
colnames(tosi_sublethal) <- tosi_sublethal_colnames
tosi_sublethal[tosi_sublethal == " "] <- NA
tosi_sublethal[tosi_sublethal == ""] <- NA
tosi_sublethal$LOAEL_unit_measure <- as.character(tosi_sublethal$LOAEL_unit_measure)
str(tosi_sublethal$LOAEL_unit_measure)
which(table(tosi_sublethal$LOAEL_unit_measure)>=1)
# could unit measures be put into a function for conversion to ppb?
tosi_sublethal_unit_measures <- c("µg/bee", "µM", "g/bee/week", "g/ha", "g/hive", "g/hm-2", "gals/acre", "µg", "µg/bee",
"µg/bee/day", "µg/larva", "µL", "µL/bee", "µM", "kg/ha", "MFR", "mL/bee", "mL/colony",
"mM", "mm3 /bee", "ng/L", "ng/ml", "nM", "nmol/bee", "nmol/day/bee", "ppb", "ppm", "unclear")
view(tosi_sublethal)
colnames(tosi_sublethal)
tosi_sublethal_colnames <- c("pesticide_name", "cas", "pesticide_type", "MoA_short", "MoA_classification_site_taret", "survey_inclusion_name", "screened_in_survey", "num_survery_screenings", "oral_LD50_geometricmean_ugbee", "oral_source_name", "contact_LD50_geometricmean_ugbee", "contact_source_name", "LOAEL_allunits", "LOAEL_unit_measure", "LOAEL_ug/bee/day", "LOAEL_category_ug/bee", "SubTR_LOAEL/LD50", "SubTR_category", "exposure_type_oral_v_contact", "exposure_type_acute_v_chronic", "exposure_duration_h", "time_after_exposure_of_significant_effect_h", "feedtype_main_category", "feedtype_subcategory", "feedtype_concentration", "bee_type", "bee_genus", "bee_species", "bee_species_details", "sublethal_effect_main_category", "sublethal_effect_subcategory", "sublethal_effect_details", "original_ref", "ref_year", "review_ref")
colnames(tosi_sublethal) <- tosi_sublethal_colnames
tosi_sublethal[tosi_sublethal == " "] <- NA
tosi_sublethal[tosi_sublethal == ""] <- NA
tosi_sublethal$LOAEL_unit_measure <- as.character(tosi_sublethal$LOAEL_unit_measure)
str(tosi_sublethal$LOAEL_unit_measure)
which(table(tosi_sublethal$LOAEL_unit_measure)>=1)
# could unit measures be put into a function for conversion to ppb?
tosi_sublethal_unit_measures <- c("µg/bee", "µM", "g/bee/week", "g/ha", "g/hive", "g/hm-2", "gals/acre", "µg", "µg/bee",
"µg/bee/day", "µg/larva", "µL", "µL/bee", "µM", "kg/ha", "MFR", "mL/bee", "mL/colony",
"mM", "mm3 /bee", "ng/L", "ng/ml", "nM", "nmol/bee", "nmol/day/bee", "ppb", "ppm", "unclear")
tosi_sublethal$LOAEL_unit_measure <- as.character(tosi_sublethal$LOAEL_unit_measure)
str(tosi_sublethal$LOAEL_unit_measure)
which(table(tosi_sublethal$LOAEL_unit_measure)>=1)
View(tosi_sublethal)
View(tl)
tosi_sublethal$LOAEL_ug_per_bee <- tosi_sublethal$`LOAEL_ug/bee/day`
tosi_sublethal$LOAEL_ug_per_bee
View(tosi_sublethal)
# remove rows with NA for LOAEL
is.na(tosi_sublethal$LOAEL_ug_per_bee)
# remove rows with NA for LOAEL
tosi_sublethal[is.na(tosi_sublethal$LOAEL_ug_per_bee), ]
# remove rows with NA for LOAEL
tosi_sublethal[!is.na(tosi_sublethal$LOAEL_ug_per_bee), ]
# remove rows with NA for LOAEL
tosi_sublethal_noNA <- tosi_sublethal[!is.na(tosi_sublethal$LOAEL_ug_per_bee), ]
tosi_sublethal_noNA$bee_type
tosi_sublethal_noNA$bee_species
tosi_sublethal_noNA$bee_genus
# make variable of bee genus simplified
ifelse(tosi_sublethal_noNA$bee_genus == "Apis", "Honeybee", ifelse(
tosi_sublethal_noNA$bee_genus == "Bombus", "Bumblebee", "Other")
)
# make variable of bee genus simplified
t=ifelse(tosi_sublethal_noNA$bee_genus == "Apis", "Honeybee", ifelse(
tosi_sublethal_noNA$bee_genus == "Bombus", "Bumblebee", "Other")
)
rbind(t, tosi_sublethal_noNA$bee_genus)
# make variable of bee genus simplified
bee_genus_simple <- ifelse(tosi_sublethal_noNA$bee_genus == "Apis", "Honeybee", ifelse(
tosi_sublethal_noNA$bee_genus == "Bombus", "Bumblebee", "Other")
)
# make variable of bee genus simplified
tosi_sublethal_noNA$bee_genus_simple <- ifelse(tosi_sublethal_noNA$bee_genus == "Apis", "Honeybee", ifelse(
tosi_sublethal_noNA$bee_genus == "Bombus", "Bumblebee", "Other")
)
TS_simpifed <- tosi_sublethal_noNA %>% # operate on the dataframe (ds_2021) and assign to new object (pltN)
group_by(bee_genus_simple) %>% # pick variables to group by
summarise(
min_LOAEL_ug_per_bee = min(LOAEL_ug_per_bee, na.rm=T), # mean
numPubs = sum(original_ref),
)
TS_simpifed <- tosi_sublethal_noNA %>% # operate on the dataframe (ds_2021) and assign to new object (pltN)
group_by(bee_genus_simple) %>% # pick variables to group by
summarise(
min_LOAEL_ug_per_bee = min(LOAEL_ug_per_bee, na.rm=T), # mean
numPubs = len(original_ref),
)
TS_simpifed <- tosi_sublethal_noNA %>% # operate on the dataframe (ds_2021) and assign to new object (pltN)
group_by(bee_genus_simple) %>% # pick variables to group by
summarise(
min_LOAEL_ug_per_bee = min(LOAEL_ug_per_bee, na.rm=T), # mean
numPubs = length(original_ref),
)
TS_simpifed
TS_simpifed <- tosi_sublethal_noNA %>% # operate on the dataframe (ds_2021) and assign to new object (pltN)
group_by(pesticide_name, bee_genus_simple) %>% # pick variables to group by
summarise(
min_LOAEL_ug_per_bee = min(LOAEL_ug_per_bee, na.rm=T), # mean
numPubs = length(original_ref),
)
TS_simpifed
TS_simplified <- tosi_sublethal_noNA %>% # operate on the dataframe (ds_2021) and assign to new object (pltN)
group_by(pesticide_name, bee_genus_simple) %>% # pick variables to group by
summarise(
min_LOAEL_ug_per_bee = min(LOAEL_ug_per_bee, na.rm=T), # mean
numPubs = length(original_ref),
)
View(TS_simplified)
################################################################################
# Cleaning LD50 Dataset -- Tosi Lethal
################################################################################
tosi_lethal
view(tosi_lethal)
# convert blank spaces to NA
tosi_lethal[tosi_lethal == " "] <- NA
tosi_lethal[tosi_lethal == ""] <- NA
# changing column names
colnames(tosi_lethal) # original column names
tosi_lethal_colnames <- c("pesticide_name", "other_names","cas", "pesticide_type", "MoA_short", "MoA_classification_site_target", "oral_LD50_geometricmean_ugbee", "oral_source_num","oral_LD50_min", "oralQ1", "oralQ2_median", "oralQ3", "oral_LD50_max", "oral_range", "oral_source_name", "oral_LD50_1", "oral_LD50_2", "oral_LD50_3", "oral_LD50_4", "oral_LD50_5", "contact_LD50_geometricmean_ugbee","contact_source_num","contact_LD50_min", "contactQ1", "contactQ2_median", "contactQ3", "contact_LD50_max","contact_range", "contact_source_name", "contact_LD50_1", "contact_LD50_2","contact_LD50_3")
colnames(tosi_lethal) <- tosi_lethal_colnames
# finding minLD50 value
# !NOTE! not sure if this is working ALEX NOTE: saving it to a variable and adding na.rm = T makes it work. Introduces Inf for all na values. making them NA in the next line
tl <- tosi_lethal %>% rowwise() %>% mutate(min_LD50_value = min(oral_LD50_min, oral_LD50_1, oral_LD50_2, oral_LD50_3, oral_LD50_4, oral_LD50_5, contact_LD50_min, contact_LD50_1, contact_LD50_2, contact_LD50_3, na.rm = TRUE))
# remove Inf values
tl$min_LD50_value <- ifelse(tl$min_LD50_value == "Inf", NA, tl$min_LD50_value)
# remove rows with NA for LD50
tosi_lethal_noNA <- tl[!is.na(tl$min_LD50_value), ]
# summarize for each chemical
TL_simplified <- tosi_lethal_noNA %>%
group_by(pesticide_name) %>% # pick variables to group by
summarise(
min_LD50_value = min(min_LD50_value, na.rm=T),
)
# unlike Tosi sublethal data, this dataset does not distinguish by publications or bee type
view(TL_simplified)
View(tosi_lethal_noNA)
view(tosi_sublethal)
View(tosi_lethal)
colnames(tosi_sublethal)
tosi_sublethal_colnames <- c("pesticide_name", "cas", "pesticide_type", "MoA_short", "MoA_classification_site_taret", "survey_inclusion_name", "screened_in_survey", "num_survery_screenings", "oral_LD50_geometricmean_ugbee", "oral_source_name", "contact_LD50_geometricmean_ugbee", "contact_source_name", "LOAEL_allunits", "LOAEL_unit_measure", "LOAEL_ug/bee/day", "LOAEL_category_ug/bee", "SubTR_LOAEL/LD50", "SubTR_category", "exposure_type_oral_v_contact", "exposure_type_acute_v_chronic", "exposure_duration_h", "time_after_exposure_of_significant_effect_h", "feedtype_main_category", "feedtype_subcategory", "feedtype_concentration", "bee_type", "bee_genus", "bee_species", "bee_species_details", "sublethal_effect_main_category", "sublethal_effect_subcategory", "sublethal_effect_details", "original_ref", "ref_year", "review_ref")
colnames(tosi_sublethal) <- tosi_sublethal_colnames
tosi_sublethal[tosi_sublethal == " "] <- NA
tosi_sublethal[tosi_sublethal == ""] <- NA
tosi_sublethal$LOAEL_unit_measure <- as.character(tosi_sublethal$LOAEL_unit_measure)
str(tosi_sublethal$LOAEL_unit_measure)
which(table(tosi_sublethal$LOAEL_unit_measure)>=1)
# could unit measures be put into a function for conversion to ppb?
tosi_sublethal_unit_measures <- c("µg/bee", "µM", "g/bee/week", "g/ha", "g/hive", "g/hm-2", "gals/acre", "μg", "μg/bee",
"μg/bee/day", "μg/larva", "μL", "μL/bee", "μM", "kg/ha", "MFR", "mL/bee", "mL/colony",
"mM", "mm3 /bee", "ng/L", "ng/ml", "nM", "nmol/bee", "nmol/day/bee", "ppb", "ppm", "unclear")
tosi_sublethal$LOAEL_ug_per_bee <- tosi_sublethal$`LOAEL_ug/bee/day`
# remove rows with NA for LOAEL
tosi_sublethal_noNA <- tosi_sublethal[!is.na(tosi_sublethal$LOAEL_ug_per_bee), ]
# make variable of bee genus simplified
tosi_sublethal_noNA$bee_genus_simple <- ifelse(tosi_sublethal_noNA$bee_genus == "Apis", "Honeybee", ifelse(
tosi_sublethal_noNA$bee_genus == "Bombus", "Bumblebee", "Other")
)
# summarize for each chemical - min value fro LOAEL - block by bee type and sum number of pubs
TS_simplified <- tosi_sublethal_noNA %>% # operate on the dataframe (ds_2021) and assign to new object (pltN)
group_by(pesticide_name, bee_genus_simple) %>% # pick variables to group by
summarise(
min_LOAEL_ug_per_bee = min(LOAEL_ug_per_bee, na.rm=T), # mean
numPubs = length(original_ref),
)
View (TS_simplified)
View (TS_simplified)
table(TS_simplified$pesticide_name)
length(table(TS_simplified$pesticide_name))
# read in pesticide descriptions
pest_descriptions <- read.csv("pesticide_data_to_merge/pestDesc.csv", header = TRUE, stringsAsFactors = FALSE, skip = 1)
pest_descriptions
View(pest_descriptions)
# read in pesticide descriptions
pest_descriptions <- read.csv("pesticide_data_to_merge/pestDesc.csv", header = TRUE, stringsAsFactors = FALSE)
View(pest_descriptions)
TS_simplified
pest_descriptions
View(pest_descriptions)
head(TS_simplified)
## Reading in datasets
# read in pesticide descriptions
pest_descriptions <- read.csv("pesticide_data_to_merge/pestDesc.csv", header = TRUE, stringsAsFactors = FALSE)
View(pest_descriptions)
View(TS_simplified)
merge(TS_simplified, pest_descriptions)
x <- merge(TS_simplified, pest_descriptions)
x <- merge(TS_simplified, pest_descriptions)
View(x)
x <- merge(TS_simplified, pest_descriptions, all.x=T)
View(x)
View(pest_descriptions)
View(pest_descriptions)
library(tidyverse)
library(dplyr)
library(ggplot2)
library(reshape2)
setwd("~/Documents/GitHub/SARE")
# Read in Cornell Results Dataset !NOTE! - find more general solution to white space/column headers
pest_Results <- read.csv("pesticide_data_to_merge/pesticide_results_2021.csv", header = TRUE,
stringsAsFactors = FALSE, skip = 1)
# Read in Tosi Datasets
tosi_lethal <- read.csv("pesticide_data_to_merge/Tosi_lethal.csv", header = TRUE, stringsAsFactors = FALSE, skip = 1)
tosi_sublethal <- read.csv("pesticide_data_to_merge/Tosi_sublethal.csv", header = TRUE, stringsAsFactors = FALSE)
# Read in Description Dataset (NHBS descriptions)
pest_Desc <- read.csv("pesticide_data_to_merge/pestDesc.csv", header = TRUE, stringsAsFactors = FALSE)
# Read in additional description information (classification info in Google Sheet from Colin)
pest_Desc_additionalinfo <- read.csv("pesticide_data_to_merge/pestDesc_additioninfo.csv", header = TRUE, stringsAsFactors = FALSE)
# Read in updated description information - Colin
pest_Desc_updated <- read.csv("pesticide_data_to_merge/updated_descriptions_4-1-23.csv")
# replace n.d. with NA
pest_Results[pest_Results == "n.d."] <- NA
# find our cut points
LS_row <- which(pest_Results == "Large Scale", arr.ind=TRUE)[1]
SS_row <- which(pest_Results == "Small Scale", arr.ind=TRUE)[1]
SS_filename_row <- which(pest_Results == "File Name", arr.ind=TRUE)[1]
bottom_row <- which(pest_Results == "Results are in ppb.", arr.ind=TRUE)[1] #find regex solution Results are in *
# cut out our data frames
LS_df <- pest_Results[1:(LS_row-1),]
SS_df <- pest_Results[(SS_filename_row+1):(SS_row-1),]
# cut out look up tables
LS_lookup <- pest_Results[LS_row:(LS_row+3),]
SS_lookup <- pest_Results[SS_row:(SS_row+3),]
#######################################################
# LIMIT FINDER FUNCTION
#######################################################
limit_finder <- function(df, search, lookup, scale){
# find where samples say <loq
loqVals <- data.frame(which(df == search, arr.ind=TRUE))
if(length(loqVals$row>0)){
# pull out mass and lod and do out the division
mass <- as.numeric(df$Mass..g.[loqVals$row])
scaleNum <- ifelse(search==">ULOQ", 3, 1) # convert scale into row index
print(scaleNum)
lod <- as.numeric(lookup[scaleNum,loqVals$col])
results <- lod/mass
# assign results to index where loq was found
for(i in 1:length(results)){
df[loqVals$row[i], loqVals$col[i]] <- results[i]
}
}
return(df)
}
LS_df <- limit_finder(df = LS_df, search = "<LOQ", lookup = LS_lookup)
SS_df <- limit_finder(df = SS_df, search = "<LOQ", lookup = SS_lookup)
LS_df <- limit_finder(df = LS_df, search = ">ULOQ", lookup = LS_lookup)
SS_df <- limit_finder(df = SS_df, search = ">ULOQ", lookup = SS_lookup)
# append dataframes
pest_df <- rbind(LS_df, SS_df)
# create small scale/large scale column
pest_df$scale <- ifelse(pest_df$Mass..g. < 1, "small", "large")
#getting rid of column "X'
pest_df$X <- NULL
str(pest_df)
# Cornell Results to long form
pest_df_long <- melt(pest_df,
id.vars = c("File.Name", "Client.ID1", "Client.ID2", "Mass..g.", "scale"))
# changing column names
colnames(pest_df_long) # original column names
pest_df_long_colnames <- c("file_name", "client_ID1", "client_ID2", "mass_g", "scale", "pesticide_name", "value")
colnames(pest_df_long) <- pest_df_long_colnames
# convert blank spaces to NA
tosi_lethal[tosi_lethal == " "] <- NA
tosi_lethal[tosi_lethal == ""] <- NA
# changing column names
colnames(tosi_lethal) # original column names
tosi_lethal_colnames <- c("pesticide_name", "other_names","cas", "pesticide_type", "MoA_short", "MoA_classification_site_target", "oral_LD50_geometricmean_ugbee", "oral_source_num","oral_LD50_min", "oralQ1", "oralQ2_median", "oralQ3", "oral_LD50_max", "oral_range", "oral_source_name", "oral_LD50_1", "oral_LD50_2", "oral_LD50_3", "oral_LD50_4", "oral_LD50_5", "contact_LD50_geometricmean_ugbee","contact_source_num","contact_LD50_min", "contactQ1", "contactQ2_median", "contactQ3", "contact_LD50_max","contact_range", "contact_source_name", "contact_LD50_1", "contact_LD50_2","contact_LD50_3")
colnames(tosi_lethal) <- tosi_lethal_colnames
# finding minLD50 value - all units are ug/bee
# NOTE: Transform to PPB
tl <- tosi_lethal %>% rowwise() %>% mutate(min_LD50_value = min(oral_LD50_min, oral_LD50_1, oral_LD50_2, oral_LD50_3, oral_LD50_4, oral_LD50_5, contact_LD50_min, contact_LD50_1, contact_LD50_2, contact_LD50_3, na.rm = TRUE))
# remove Inf values
tl$min_LD50_value <- ifelse(tl$min_LD50_value == "Inf", NA, tl$min_LD50_value)
# remove rows with NA for LD50
tosi_lethal_noNA <- tl[!is.na(tl$min_LD50_value), ]
# summarize for each chemical
TL_simplified <- tosi_lethal_noNA %>%
group_by(pesticide_name) %>% # pick variables to group by
summarise(
min_LD50_value = min(min_LD50_value, na.rm=T),
)
colnames(tosi_sublethal)
tosi_sublethal_colnames <- c("pesticide_name", "cas", "pesticide_type", "MoA_short", "MoA_classification_site_taret", "survey_inclusion_name", "screened_in_survey", "num_survery_screenings", "oral_LD50_geometricmean_ugbee", "oral_source_name", "contact_LD50_geometricmean_ugbee", "contact_source_name", "LOAEL_allunits", "LOAEL_unit_measure", "LOAEL_ug/bee/day", "LOAEL_category_ug/bee", "SubTR_LOAEL/LD50", "SubTR_category", "exposure_type_oral_v_contact", "exposure_type_acute_v_chronic", "exposure_duration_h", "time_after_exposure_of_significant_effect_h", "feedtype_main_category", "feedtype_subcategory", "feedtype_concentration", "bee_type", "bee_genus", "bee_species", "bee_species_details", "sublethal_effect_main_category", "sublethal_effect_subcategory", "sublethal_effect_details", "original_ref", "ref_year", "review_ref")
colnames(tosi_sublethal) <- tosi_sublethal_colnames
tosi_sublethal[tosi_sublethal == " "] <- NA
tosi_sublethal[tosi_sublethal == ""] <- NA
tosi_sublethal$LOAEL_unit_measure <- as.character(tosi_sublethal$LOAEL_unit_measure)
str(tosi_sublethal$LOAEL_unit_measure)
which(table(tosi_sublethal$LOAEL_unit_measure)>=1)
# could unit measures be put into a function for conversion to ppb?
tosi_sublethal_unit_measures <- c("µg/bee", "µM", "g/bee/week", "g/ha", "g/hive", "g/hm-2", "gals/acre", "μg", "μg/bee",
"μg/bee/day", "μg/larva", "μL", "μL/bee", "μM", "kg/ha", "MFR", "mL/bee", "mL/colony",
"mM", "mm3 /bee", "ng/L", "ng/ml", "nM", "nmol/bee", "nmol/day/bee", "ppb", "ppm", "unclear")
tosi_sublethal$LOAEL_ug_per_bee <- tosi_sublethal$`LOAEL_ug/bee/day`
# remove rows with NA for LOAEL
tosi_sublethal_noNA <- tosi_sublethal[!is.na(tosi_sublethal$LOAEL_ug_per_bee), ]
# make variable of bee genus simplified
tosi_sublethal_noNA$bee_genus_simple <- ifelse(tosi_sublethal_noNA$bee_genus == "Apis", "Honeybee", ifelse(
tosi_sublethal_noNA$bee_genus == "Bombus", "Bumblebee", "Other")
)
# TO DO: convert to PPB
# LOAEL: Lowest Observed Adverse effect level
# N studies found sublethal impacts of this chemical on beeGenera. The lowest concentration accross studies is X
# summarize for each chemical - min value fro LOAEL - block by bee type and sum number of pubs
TS_simplified <- tosi_sublethal_noNA %>% # operate on the dataframe (ds_2021) and assign to new object (pltN)
group_by(pesticide_name, bee_genus_simple) %>% # pick variables to group by
summarise(
min_LOAEL_ug_per_bee = min(LOAEL_ug_per_bee, na.rm=T), # mean
numPubs = length(original_ref),
)
################################################
# Cleaning Pest_Desc Dataset (NHBS descriptions)
################################################
# pest_Desc
# changing column names
colnames(pest_Desc) # original column names
pest_Desc_colnames <- c("pesticide_name", "description", "pesticide_type")
colnames(pest_Desc) <- pest_Desc_colnames
# eliminating rows with redundant values from transition to csv
pest_Desc <- subset(pest_Desc, pest_Desc$pesticide_name != "Pesticide")
pest_Desc_updated[pest_Desc_updated == " "] <- NA
pest_Desc_updated[pest_Desc_updated == ""] <- NA
## 1st description dataset merge
# Merging pest_Desc_additionalinfo to pest_Desc, creating pest_Desc_combined
pest_Desc_combined <- merge(y = pest_Desc, x = pest_Desc_additionalinfo, by = "pesticide_name", all = TRUE)
##2nd description dataset merge
# Merging pest_Desc_updated into pest_Desc_combined
pest_Desc_combined <- merge(y = pest_Desc_combined, x = pest_Desc_updated , by = "pesticide_name", all = TRUE)
# Merging Tosi Datasets
tosi_combined <- merge(TL_simplified, TS_simplified, by = "pesticide_name", all = TRUE)
# Merging Tosi combined dataset with the combined pesticide description dataset
tosiDesc_combined <- merge(tosi_combined, pest_Desc_combined, by = "pesticide_name", all = TRUE)
# removing unwanted columns
tosiDesc_combined <- tosiDesc_combined %>%
select(-description.x, -description.y, -pesticide_type.y)
pest_DescResults_combined <- merge(tosiDesc_combined, pest_df_long, by = "pesticide_name", all = TRUE)
pest_DescResults_combined
write.csv(pest_DescResults_combined, "pest_DescResults_combined.csv")
